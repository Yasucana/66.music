<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Rhythm RPG</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background-color: #fff;
            border: 2px solid #000;
            overflow: hidden;
        }
        #battle-area {
            position: absolute;
            top: 50px;
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e0e0e0;
        }
        #player, #enemy {
            width: 100px;
            height: 100px;
            background-size: cover;
        }
        #player {
            background-image: url('https://via.placeholder.com/100?text=Player');
        }
        #enemy {
            background-image: url('https://via.placeholder.com/100?text=Enemy');
        }
        #rhythm-bar {
            position: absolute;
            top: 300px;
            width: 600px;
            height: 50px;
            left: 100px;
            background-color: #333;
            border: 2px solid #000;
        }
        .note {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #ff4444;
            border-radius: 50%;
            top: 5px;
        }
        #hit-zone {
            position: absolute;
            width: 50px;
            height: 50px;
            left: 500px;
            background-color: rgba(0, 255, 0, 0.3);
            border: 2px solid green;
        }
        #status {
            position: absolute;
            top: 400px;
            width: 100%;
            text-align: center;
            font-size: 20px;
        }
        #start-button {
            position: absolute;
            top: 500px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="battle-area">
            <div id="player"></div>
            <div id="enemy"></div>
        </div>
        <div id="rhythm-bar">
            <div id="hit-zone"></div>
        </div>
        <div id="status">Press 'Start' to begin!</div>
        <button id="start-button">Start</button>
    </div>

    <script>
        const rhythmBar = document.getElementById('rhythm-bar');
        const hitZone = document.getElementById('hit-zone');
        const status = document.getElementById('status');
        const startButton = document.getElementById('start-button');

        let playerHP = 100;
        let enemyHP = 100;
        let notes = [];
        let gameActive = false;
        let lastNoteTime = 0;
        const noteInterval = 1000; // Notes spawn every 1 second
        const noteSpeed = 0.2; // Pixels per millisecond
        const hitWindow = 100; // Hit window in milliseconds

        // Simple audio (using oscillator for a beat sound)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeat() {
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        // Start game
        startButton.addEventListener('click', () => {
            if (!gameActive) {
                gameActive = true;
                startButton.style.display = 'none';
                status.textContent = `Player HP: ${playerHP} | Enemy HP: ${enemyHP}`;
                gameLoop();
                spawnNotes();
            }
        });

        // Spawn notes periodically
        function spawnNotes() {
            if (!gameActive) return;
            const note = document.createElement('div');
            note.classList.add('note');
            note.style.left = '0px';
            rhythmBar.appendChild(note);
            notes.push({ element: note, startTime: performance.now() });
            playBeat();
            setTimeout(spawnNotes, noteInterval);
        }

        // Game loop for moving notes and checking game state
        function gameLoop() {
            if (!gameActive) return;
            const currentTime = performance.now();
            notes = notes.filter(note => {
                const elapsed = currentTime - note.startTime;
                const position = elapsed * noteSpeed;
                note.element.style.left = `${position}px`;

                if (position > 600) {
                    note.element.remove();
                    playerHP -= 10;
                    updateStatus();
                    return false;
                }
                return true;
            });

            if (playerHP <= 0) {
                gameActive = false;
                status.textContent = 'Game Over! You Lost!';
                return;
            }
            if (enemyHP <= 0) {
                gameActive = false;
                status.textContent = 'Victory! You Defeated the Enemy!';
                return;
            }

            requestAnimationFrame(gameLoop);
        }

        // Handle key press for rhythm hits
        document.addEventListener('keydown', (e) => {
            if (!gameActive || e.key !== ' ') return;
            const currentTime = performance.now();
            let hit = false;

            notes = notes.filter(note => {
                const elapsed = currentTime - note.startTime;
                const position = elapsed * noteSpeed;
                const hitZonePos = 500;

                if (Math.abs(position - hitZonePos) < hitWindow * noteSpeed) {
                    note.element.remove();
                    enemyHP -= 20;
                    status.textContent = 'Hit!';
                    hit = true;
                    updateStatus();
                    return false;
                }
                return true;
            });

            if (!hit) {
                playerHP -= 5;
                status.textContent = 'Miss!';
                updateStatus();
            }
        });

        // Update status display
        function updateStatus() {
            setTimeout(() => {
                status.textContent = `Player HP: ${playerHP} | Enemy HP: ${enemyHP}`;
            }, 500);
        }
    </script>
</body>
</html>